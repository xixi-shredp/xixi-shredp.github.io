<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Sequential Consistency (SC) 内存模型简介">
<meta property="og:type" content="article">
<meta property="og:title" content="Sequential Consistency (SC)">
<meta property="og:url" content="http://example.com/2025/09/12/Arch/mem/consistency/SC/index.html">
<meta property="og:site_name" content="xixi&#39;s blog">
<meta property="og:description" content="Sequential Consistency (SC) 内存模型简介">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/Arch/mem/consistency/SC/the_switch.svg">
<meta property="og:image" content="http://example.com/images/Arch/mem/consistency/SC/basic_sc_imple.svg">
<meta property="article:published_time" content="2025-09-12T09:43:39.000Z">
<meta property="article:modified_time" content="2025-09-12T12:27:05.075Z">
<meta property="article:author" content="xixi">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/Arch/mem/consistency/SC/the_switch.svg">

<link rel="canonical" href="http://example.com/2025/09/12/Arch/mem/consistency/SC/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Sequential Consistency (SC) | xixi's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">xixi's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">life is so beautiful!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/09/12/Arch/mem/consistency/SC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="xixi">
      <meta itemprop="description" content="xixi's personal blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xixi's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Sequential Consistency (SC)
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-09-12 17:43:39 / Modified: 20:27:05" itemprop="dateCreated datePublished" datetime="2025-09-12T17:43:39+08:00">2025-09-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Arch/" itemprop="url" rel="index"><span itemprop="name">Arch</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Arch/mem/" itemprop="url" rel="index"><span itemprop="name">mem</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Arch/mem/consistency/" itemprop="url" rel="index"><span itemprop="name">consistency</span></a>
                </span>
            </span>

          
            <div class="post-description">Sequential Consistency (SC) 内存模型简介</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><h2 id="第一次提出的定义"><a href="#第一次提出的定义" class="headerlink" title="第一次提出的定义"></a>第一次提出的定义</h2><blockquote>
<p>L. Lamport. How to make a multiprocessor computer that correctly executes multiprocess programs. IEEE Transactions on Computers, C-28(9):690–91, September 1979. DOI: 10.1109&#x2F;tc.1979.1675439. 22, 35</p>
</blockquote>
<p>单处理器 sequential: 执行的结果与按照程序指定的顺序执行的结果相同</p>
<p>多处理器 sequentially consistent:<br>任何执行的结果都相当于以某种顺序依次执行所有处理器（核心）的操作，并且每个单独的处理器（核心）的操作按照其程序指定的顺序出现在该序列中 </p>
<p>memory order: 程序指定的所有操作的顺序</p>
<p>SC 模型严格遵守 memory order</p>
<h2 id="以公理的形式定义"><a href="#以公理的形式定义" class="headerlink" title="以公理的形式定义"></a>以公理的形式定义</h2><blockquote>
<p>D. L. Weaver and T. Germond, Eds. SPARC Architecture Manual (Version 9). PTR Prentice Hall, 1994. 23</p>
</blockquote>
<p>符号表:  </p>
<table>
<thead>
<tr>
<th>L(a) &#x2F; S(a)</th>
<th>对地址 a 的 Load&#x2F;Store</th>
</tr>
</thead>
<tbody><tr>
<td>&lt;p</td>
<td>Program Order: 每个核顺序执行所有访存操作的 total order</td>
</tr>
<tr>
<td>&lt;m</td>
<td>Global Order: 所有核的访存操作的 total order</td>
</tr>
</tbody></table>
<p>SC execution 的要求:  </p>
<ol>
<li>所有核将自己的 load&#x2F;store 插入 global order &lt;m 的时候需满足各自的 program order &lt;p (不论访存地址是否相同)<ul>
<li>if L(a) &lt;p L(b) &#x3D;&gt; L(a) &lt;m L(b)</li>
<li>if L(a) &lt;p S(b) &#x3D;&gt; L(a) &lt;m S(b)</li>
<li>if S(a) &lt;p S(b) &#x3D;&gt; S(a) &lt;m S(b)</li>
<li>if S(a) &lt;p L(b) &#x3D;&gt; S(a) &lt;m L(b)</li>
</ul>
</li>
<li>每次 load 拿到的值是 global order 中该 load 之前的最后一次 store 的值<ul>
<li>Value of L(a) &#x3D; Value of $MAX_{&lt;m} {S(a) | S(a) &lt;m L(a)}$, $MAX_{&lt;m}$ 表示 &lt;m 中最近的操作</li>
</ul>
</li>
</ol>
<p>SC ordering rules (X 表示强制定序):  </p>
<table>
	<tr align="center">
	    <td colspan="5">Operation 2</td>
	</tr>
	<tr>
	    <td rowspan="4">Operation 1</td>
	    <td></td>
	    <td>Load</td>
	    <td>Store</td>
	    <td>RMW</td>
	</tr>
	<tr>
	    <td>Load</td>
	    <td>X</td>
	    <td>X</td>
	    <td>X</td>
	</tr>
	<tr>
	    <td>Store</td>
	    <td>X</td>
	    <td>X</td>
	    <td>X</td>
	</tr>
	<tr>
	    <td>RMW</td>
	    <td>X</td>
	    <td>X</td>
	    <td>X</td>
	</tr>
</table>

<blockquote>
<p>第一个证明每个核向其 cache(支持 cache coherence) 发出的访存请求满足 program order 时满足 SC 模型:<br>A. Meixner and D. J. Sorin. Dynamic verification of memory consistency in cachecoherent multithreaded computer architectures. In Proc. of the International Conference on Dependable Systems and Networks, pp. 73–82, June 2006. DOI: 10.1109&#x2F;dsn.2006.29. 35_</p>
</blockquote>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><h2 id="Naive-Implementations"><a href="#Naive-Implementations" class="headerlink" title="Naive Implementations"></a>Naive Implementations</h2><ol>
<li>The Multitasking Uniprocessor: 在单个顺序核上执行所有线程<ul>
<li>要求上下文切换前访存操作必须全部完成。</li>
</ul>
</li>
<li>The Switch: 多个核将访存操作提交给一个 switch 选择执行<ul>
<li>每个核提交的访存操作需满足自己的 program order</li>
<li>switch 选择核来执行实际的访存，需要满足 global order</li>
<li>switch 选择的策略不能饿死某个核的 ready 请求以保证公平</li>
</ul>
</li>
</ol>
<p>The Switch:<br><img src="/images/Arch/mem/consistency/SC/the_switch.svg" alt="The Switch"></p>
<ul>
<li>满足 SC 模型</li>
<li>缺点: 顺序瓶颈问题: 不具备可扩展性（核数增多时性能瓶颈）</li>
</ul>
<h2 id="支持-Cache-Coherence-的基础实现"><a href="#支持-Cache-Coherence-的基础实现" class="headerlink" title="支持 Cache Coherence 的基础实现"></a>支持 Cache Coherence 的基础实现</h2><p><img src="/images/Arch/mem/consistency/SC/basic_sc_imple.svg" alt="支持 Cache Coherence 的基础实现"></p>
<ul>
<li>L1Cache 中的 block 需要支持 modified(M) 和 shared(S) 两个状态<ol>
<li>modified 状态表示一个核可以对其进行读写</li>
<li>shared 状态表示一个或多个核对其只可读</li>
</ol>
</li>
</ul>
<p>通过基本的 cache coherence 保证了 SWMR 的不变性以实现 SC</p>
<ol>
<li>对于地址不冲突的访存请求可以并发执行，提高可扩展性</li>
<li>将 core 的实现与 coherence 的实现解耦</li>
</ol>
<h2 id="支持-Cache-Coherence-的优化实现"><a href="#支持-Cache-Coherence-的优化实现" class="headerlink" title="支持 Cache Coherence 的优化实现"></a>支持 Cache Coherence 的优化实现</h2><p>与其他 CPU 特性结合使用以提高性能</p>
<h3 id="Non-Binding-Prefetching"><a href="#Non-Binding-Prefetching" class="headerlink" title="Non-Binding Prefetching"></a>Non-Binding Prefetching</h3><p>在 cache-coherenct memory system 中对 block 的预取会改变 block 的 coherence 状态，而对于 memory consistency model 而言预取相当于 nop ，因为对 coherence 状态的获取时间不会影响每个 core 本身的 program order</p>
<h3 id="Speculative-Cores"><a href="#Speculative-Cores" class="headerlink" title="Speculative Cores"></a>Speculative Cores</h3><p>分支指令之后的 load&#x2F;store 在遇到分支预测失败时会被冲刷出流水线。</p>
<ul>
<li>对于被冲刷的 load 而言，如果访存请求已经发出，其效果相当于预取，不会影响 SC</li>
<li>对于被冲刷的 store 而言，相当于发出 getM 的 coherence 状态请求，实际的 store 并未发生(store 只有在达到 ROB 的顶端确认可以执行时才会执行)</li>
</ul>
<h3 id="Dynamically-Scheduled-Cores"><a href="#Dynamically-Scheduled-Cores" class="headerlink" title="Dynamically Scheduled Cores"></a>Dynamically Scheduled Cores</h3><p>乱序执行&#x2F;动态调度可能会对不相关的 load 指令重排序(其他核不可见)，会违反 SC 规定的 program order</p>
<ol>
<li>对于 SC 的预测执行，需要验证乱序核的预测执行是否正确（和其他核的请求不冲突）: L1 -&gt; L2 (预测执行先执行 L2)</li>
<li>乱序核预测执行完 L2 ，在 commit L2 之前检查 cache 中 evict 的 block 以及向 cache 发出的 coherence 请求等是否和 L2 请求的 block 一致<ul>
<li>如果此时有 GetM 的请求或者 block 一致，说明其他核会试图写入该 block, 乱序核需要使预测执行失效</li>
</ul>
</li>
<li>在预测执行的 L2 指令 commit 时再次发出 load 请求<ul>
<li>如果两次 load 的值相同，说明预测执行正确，否则说明有其他核在该 load 执行和 commit 之间发出了冲突的写请求，此时乱序核需要清除预测执行</li>
<li>对于支持值预测的处理器而言，不能比较两次 load 的结果 (ABA problem)</li>
</ul>
</li>
</ol>
<blockquote>
<p>K. Gharachorloo, A. Gupta, and J. Hennessy. Two techniques to enhance the performance of memory consistency models. In Proc. of the International Conference on Parallel Processing, vol. I, pp. 355–64, August 1991. 30_</p>
</blockquote>
<h3 id="Multithreading"><a href="#Multithreading" class="headerlink" title="Multithreading"></a>Multithreading</h3><p>一个核内的多个线程共享 L1 cache ：粗粒度多线程、细粒度多线程、同时多线程</p>
<p>需要确保线程 T1 不能读到同一核内另一个线程 T2 此时正在写入的值（该写入此时对其他线程还不可见）</p>
<h3 id="Post-retirement-speculation"><a href="#Post-retirement-speculation" class="headerlink" title="Post-retirement speculation"></a>Post-retirement speculation</h3><p>单核乱序核中的 write buffer 将所有的 store 加入以隐藏 store miss latency, 同时 load 指令通过访问 write buffer 检查相关性</p>
<p>多核中 store miss latency 会更长，为提高性能, 可以预测性地使 store miss 之前的 load&#x2F;store 指令退役，同时维护这些预测性退役的指令的状态</p>
<blockquote>
<p><strong>细粒度</strong>：  </p>
<ol>
<li>C. Guiady, B. Falsafi, and T. Vijaykumar. Is SC C ILP D RC? In Proc. of the 26th Annual International Symposium on Computer Architecture, pp. 162–71, May 1999. DOI: 10.1109&#x2F;isca.1999.765948. 32</li>
<li>P. Ranganathan, V. S. Pai, and S. V. Adve. Using speculative retirement and larger instruction windows to narrow the performance gap between memory consistency models. In Proc. of the 9th ACM Symposium on Parallel Algorithms and Architectures, pp. 199–210, June 1997. DOI: 10.1145&#x2F;258492.258512. 32</li>
</ol>
<p><strong>粗粒度</strong>：  </p>
<ol>
<li>C. Blundell, M. M. K. Martin, and T. F. Wenisch. InvisiFence: Performance-transparent memory ordering in conventional multiprocessors. In Proc. of the 36th Annual International Symposium on Computer Architecture, June 2009. DOI: 10.1145&#x2F;1555754.1555785. 32</li>
<li>L. Ceze, J. Tuck, P. Montesinos, and J. Torrellas. BulkSC: Bulk enforcement of sequential consistency. In Proc. of the 34th Annual International Symposium on Computer Architecture, June 2007. DOI: 10.1145&#x2F;1250662.1250697. 32</li>
<li>L. Hammond et al. Transactional memory coherence and consistency. In Proc. of the 31st Annual International Symposium on Computer Architecture, June 2004. DOI: 10.1109&#x2F;isca.2004.1310767. 32</li>
<li>T. F. Wenisch, A. Ailamaki, A. Moshovos, and B. Falsafi. Mechanisms for store-wait-free multiprocessors. In Proc. of the 34th Annual International Symposium on Computer Architecture, June 2007. DOI: 10.1145&#x2F;1250662.1250696. 32</li>
</ol>
</blockquote>
<h3 id="Non-speculative-reordering"><a href="#Non-speculative-reordering" class="headerlink" title="Non-speculative reordering"></a>Non-speculative reordering</h3><p>采用非预测执行的方式乱序执行访存指令以满足 SC ，同时这种重排序不能被其他核看到</p>
<p>coherence delaying:<br>当一个更年轻的访存指令要退役时如果旧的访存指令还未退役，年轻访存指令的 coherence 请求会延时直到旧访存指令退役。可能会导致死锁，需要检测规避</p>
<p>predecessor serialization:<br>旧的访存操作需要确保新的访存操作在其之后完成是安全的</p>
<ol>
<li>Conflict Ordering: 允许 load&#x2F;store 在 store miss 之后退役，要求<ul>
<li>未完成的 store 是顺序的</li>
<li>新的访存操作和该 store miss 不冲突</li>
</ul>
</li>
<li>Gope and Lipasti 对于顺序处理器的定制方法: load&#x2F;store 可以顺序地从目录中取出互斥锁，乱序地退役</li>
<li>借助于编译器或者 MMU 的帮助使得访存操作被安全地重排序<ul>
<li>thread-private 和 read-only 变量可以被安全重排序</li>
</ul>
</li>
</ol>
<blockquote>
<ol>
<li>Conflict Ordering:<br>C. Lin, V. Nagarajan, R. Gupta, and B. Rajaram. Efficient sequential consistency via conflict ordering. In Proc. of the 17th International Conference on Architectural Support for Programming Languages and Operating Systems ASPLOS, 2012. DOI: 10.1145&#x2F;2150976.2151006. 32_</li>
<li>Gope and Lipasti<br>D. Gope and M. H. Lipasti. Atomic SC for simple in-order processors. In 20th IEEE International Symposium on High Performance Computer Architecture, 2014. DOI: 10.1109&#x2F;hpca.2014.6835950. 32</li>
<li>借助编译器或 MMU 的帮助<br>A. Singh, S. Narayanasamy, D. Marino, T.D Millstein, and M. Musuvathi. End-to-end sequential consistency. In 39th International Symposium on Computer Architecture, 2012. DOI: 10.1109&#x2F;isca.2012.6237045. 32</li>
</ol>
</blockquote>
<h1 id="SC-下的原子操作"><a href="#SC-下的原子操作" class="headerlink" title="SC 下的原子操作"></a>SC 下的原子操作</h1><p>原子操作用于多线程程序的同步，实现自旋锁或同步原语。</p>
<p>常用的原子指令为 read-modify-write(RMW) 包括：  </p>
<ol>
<li>test-and-set</li>
<li>fetch-and-increment</li>
<li>compare-and-swap</li>
</ol>
<p>在 SC 模型中， RMW 指令的 load 和 store 在 memory-order 上必须连续出现</p>
<h2 id="原子操作的实现"><a href="#原子操作的实现" class="headerlink" title="原子操作的实现"></a>原子操作的实现</h2><ol>
<li>naive 实现: 执行原子操作时锁住 memory system ，不允许其他核进行访存操作<ul>
<li>实现正确，直观，但牺牲了性能</li>
</ul>
</li>
<li>激进实现: 一个核将其 cache 中的某个 block 获取到 M 状态后对其进行连续的 load 和 store，且在 store 完成以前该 block 不能响应其他核的 coherence 请求</li>
<li>优化实现：一个核的 cache 如果有一个只读状态的 block ，先预测地 load 一次，再获取到该 block 的 M 状态时，执行 store ，并在 load 和 store 之间检查该 block 是否被踢出 cache<ul>
<li>如果被踢出，需要 squash 之前预测执行的 load</li>
</ul>
</li>
</ol>
<h1 id="实例：-MIPS-R10000"><a href="#实例：-MIPS-R10000" class="headerlink" title="实例： MIPS R10000"></a>实例： MIPS R10000</h1><ul>
<li>实现了 directory coherence protocol: MESI</li>
<li>系统总线最多连接 4 个核</li>
</ul>
<h2 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h2><ul>
<li>以 program order 将 load &#x2F; store 放入 address queue ，并预测发射执行</li>
<li>如果 address queue 中地址匹配， load 可以从 store 获得前递数据，否则从 dcache 中获取</li>
<li>如果 cache 中和 load 相关的 block 因为 coherence 失效或者冲突失效而被踢出时， load 之后的所有指令全部需要 squash 并重新执行</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/09/12/Arch/mem/consistency/overview/" rel="prev" title="Memory Consistency And Cache Coherence">
      <i class="fa fa-chevron-left"></i> Memory Consistency And Cache Coherence
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/09/12/Arch/mem/consistency/TSO/" rel="next" title="Total Store Order (TSO)">
      Total Store Order (TSO) <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-number">1.</span> <span class="nav-text">定义</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%8F%90%E5%87%BA%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">1.1.</span> <span class="nav-text">第一次提出的定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A5%E5%85%AC%E7%90%86%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%AE%9A%E4%B9%89"><span class="nav-number">1.2.</span> <span class="nav-text">以公理的形式定义</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.</span> <span class="nav-text">实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Naive-Implementations"><span class="nav-number">2.1.</span> <span class="nav-text">Naive Implementations</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%AF%E6%8C%81-Cache-Coherence-%E7%9A%84%E5%9F%BA%E7%A1%80%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.2.</span> <span class="nav-text">支持 Cache Coherence 的基础实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%AF%E6%8C%81-Cache-Coherence-%E7%9A%84%E4%BC%98%E5%8C%96%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.3.</span> <span class="nav-text">支持 Cache Coherence 的优化实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Non-Binding-Prefetching"><span class="nav-number">2.3.1.</span> <span class="nav-text">Non-Binding Prefetching</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Speculative-Cores"><span class="nav-number">2.3.2.</span> <span class="nav-text">Speculative Cores</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dynamically-Scheduled-Cores"><span class="nav-number">2.3.3.</span> <span class="nav-text">Dynamically Scheduled Cores</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multithreading"><span class="nav-number">2.3.4.</span> <span class="nav-text">Multithreading</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Post-retirement-speculation"><span class="nav-number">2.3.5.</span> <span class="nav-text">Post-retirement speculation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Non-speculative-reordering"><span class="nav-number">2.3.6.</span> <span class="nav-text">Non-speculative reordering</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SC-%E4%B8%8B%E7%9A%84%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C"><span class="nav-number">3.</span> <span class="nav-text">SC 下的原子操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.1.</span> <span class="nav-text">原子操作的实现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E4%BE%8B%EF%BC%9A-MIPS-R10000"><span class="nav-number">4.</span> <span class="nav-text">实例： MIPS R10000</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C"><span class="nav-number">4.1.</span> <span class="nav-text">执行</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="xixi"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">xixi</p>
  <div class="site-description" itemprop="description">xixi's personal blog</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xixi-shredp" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xixi-shredp" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xixi</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  













<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

</body>
</html>
