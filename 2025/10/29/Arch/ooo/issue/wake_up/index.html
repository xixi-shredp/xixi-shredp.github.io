<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>OOO CPU Issue Stage: Wake Up | xixi's blog</title><meta name="author" content="xixi"><meta name="copyright" content="xixi"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="乱序执行 CPU 发射阶段唤醒电路简介">
<meta property="og:type" content="article">
<meta property="og:title" content="OOO CPU Issue Stage: Wake Up">
<meta property="og:url" content="https://xixi-shredp.github.io/2025/10/29/Arch/ooo/issue/wake_up/index.html">
<meta property="og:site_name" content="xixi&#39;s blog">
<meta property="og:description" content="乱序执行 CPU 发射阶段唤醒电路简介">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://xixi-shredp.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2025-10-29T12:08:11.000Z">
<meta property="article:modified_time" content="2026-02-08T15:32:07.574Z">
<meta property="article:author" content="xixi">
<meta property="article:tag" content="CPU, Computer Architechture, OS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xixi-shredp.github.io/img/avatar.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "OOO CPU Issue Stage: Wake Up",
  "url": "https://xixi-shredp.github.io/2025/10/29/Arch/ooo/issue/wake_up/",
  "image": "https://xixi-shredp.github.io/img/avatar.jpg",
  "datePublished": "2025-10-29T12:08:11.000Z",
  "dateModified": "2026-02-08T15:32:07.574Z",
  "author": [
    {
      "@type": "Person",
      "name": "xixi",
      "url": "https://xixi-shredp.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.svg"><link rel="canonical" href="https://xixi-shredp.github.io/2025/10/29/Arch/ooo/issue/wake_up/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'OOO CPU Issue Stage: Wake Up',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.1.1"></head><body><div class="bg-animation" id="web_bg" style="background-image: url(/img/default_top.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">47</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">29</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/default_top.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/favicon.svg" alt="Logo"><span class="site-name">xixi's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">OOO CPU Issue Stage: Wake Up</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">OOO CPU Issue Stage: Wake Up</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-10-29T12:08:11.000Z" title="Created 2025-10-29 20:08:11">2025-10-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-02-08T15:32:07.574Z" title="Updated 2026-02-08 23:32:07">2026-02-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Arch/">Arch</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Arch/ooo/">ooo</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Arch/ooo/issue/">issue</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>任务：<u>将功能单元计算出的结果通知到发射队列当中所有等待该数据的指令</u></p>
<h1 id="Tomasulo-算法唤醒"><a href="#Tomasulo-算法唤醒" class="headerlink" title="Tomasulo 算法唤醒"></a>Tomasulo 算法唤醒</h1><p>当指令执行完之后才将相关指令进行唤醒。</p>
<p><img src="/img/tomasulo_wakeup.svg" alt="Tomasulo 算法唤醒电路"></p>
<h1 id="back-to-back-背靠背执行唤醒"><a href="#back-to-back-背靠背执行唤醒" class="headerlink" title="back-to-back 背靠背执行唤醒"></a>back-to-back 背靠背执行唤醒</h1><h2 id="对于单周期指令"><a href="#对于单周期指令" class="headerlink" title="对于单周期指令"></a>对于单周期指令</h2><p><img src="/img/is_wakeup_1.png" alt="单周期指令背靠背执行唤醒"></p>
<ul>
<li>被仲裁电路选中的指令将其目的寄存器编号发送的对应的总线上广播 (tag bus)</li>
<li>发射队列当中的所有指令将 tag bus 上的编号和自己的源寄存器编号对比，如匹配则标记为 ready<br> 通过旁路网络获得寄存器值（这样才能背靠背执行）</li>
<li>发射队列当中的指令如果源操作数均 ready ，则可以向仲裁电路发出请求<ul>
<li>一条指令可以轮流向多个仲裁电路发送请求，直到找到愿意响应的仲裁电路（平衡负载）</li>
</ul>
</li>
<li>仲裁电路对所有发送请求的指令进行仲裁选择发射<ul>
<li>未发射的指令需要在下个 cycle 继续发送请求</li>
<li>发射的指令会收到仲裁电路的响应信号，并将其目的寄存器编号广播（第 1 步）<br>不会马上离开发射队列：对于访存指令而言可能出现访存违例</li>
</ul>
</li>
</ul>
<p>发射队列对单周期指令唤醒电路的影响：</p>
<ol>
<li>如果使用多个小容量的发射队列（分布式）<ul>
<li>由于总容量并不变，所以 tag bus 总体的复杂度不变（由于布局布线的问题，可能复杂度会上升）</li>
<li>但每个发射队列上仲裁电路的请求端变少，可以加快仲裁电路</li>
</ul>
</li>
</ol>
<h2 id="对于多周期指令"><a href="#对于多周期指令" class="headerlink" title="对于多周期指令"></a>对于多周期指令</h2><p>将唤醒划分为 2 个主要阶段：</p>
<ol>
<li>广播：被仲裁电路选中的指令的目的寄存器编号被送到 tag bus 上</li>
<li>唤醒：将 tag bus 上的寄存器编号和发射队列中所有指令的源寄存器编号比较</li>
</ol>
<p>多周期指令的唤醒，需要根据其在功能单元中执行的周期数将唤醒过程延迟，所以就有 2 种延迟方法：</p>
<ol>
<li>延迟广播 (delayed tag broadcast)</li>
<li>延迟唤醒 (delayed wake-up)</li>
</ol>
<h3 id="延迟广播-delayed-tag-broadcast"><a href="#延迟广播-delayed-tag-broadcast" class="headerlink" title="延迟广播 (delayed tag broadcast)"></a>延迟广播 (delayed tag broadcast)</h3><p>指令被选中的当前周期，并不将指令的目的寄存器编号立刻送到 tag bus 上，而是延迟 (N - 1) 个周期后送到总线上（对于执行周期为 N 的指令）</p>
<p><img src="/img/is_wakeup_2.png" alt="多周期指令延迟广播唤醒"></p>
<p>问题：可能导致 tag bus 冲突<br><img src="/img/is_wakeup_3.png" alt="多周期指令延迟广播唤醒 tag bus 冲突问题"></p>
<p>tag bus 冲突解决方案：</p>
<ol>
<li>方案1: 增加这个功能单元对应的 tag bus 数<br>不具有可扩展性：需要大量总线，唤醒电路复杂度大幅上升</li>
<li>方案2: 使用表格记录每条指令的执行周期<br>后续指令通过查表发现冲突后延时到下个 cycle 继续仲裁<ul>
<li>关于表格的实现方案：(trade-off)<ul>
<li>访问表格和仲裁电路并行工作<ul>
<li>不会增加延时，但造成性能损失：在基于 oldest-first 的仲裁规则下, tag bus 冲突会导致后续可被仲裁的指令都被延时</li>
<li><strong>如果不遵循 oldest-first 呢？</strong></li>
</ul>
</li>
<li>访问表格和仲裁电路串行工作：指令首先查找表格，没有冲突后再向仲裁电路发出请求<ul>
<li>后续的指令不会受到前面冲突的影响（站在仲裁电路的角度看，前面冲突的第二条指令其实是未 ready 的）</li>
<li>缺点是串行访问会增大延时</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><img src="/img/is_wakeup_4.png" alt="解决 tag bus 的冲突问题"></p>
<h3 id="延迟唤醒（delayed-wake-up）"><a href="#延迟唤醒（delayed-wake-up）" class="headerlink" title="延迟唤醒（delayed wake-up）"></a>延迟唤醒（delayed wake-up）</h3><p>指令被选中的当前周期，就将指令的目的寄存器编号立刻送到 tag bus 上并和所有指令的源寄存器编号比较。但匹配项并不立即置位 ready ，延时 (N-1) 个周期后再置位 ready</p>
<p><img src="/img/is_wakeup_delayed_wakeup.png" alt="多周期指令延迟唤醒"></p>
<ul>
<li>不存在 tag bus 的冲突问题</li>
<li>本质是在发射队列的每条指令的 ready 位前增加延时寄存器</li>
</ul>
<p>实现方案1：移位寄存器</p>
<p><img src="/img/is_wakeup_shifter.png" alt="移位寄存器实现延迟唤醒"></p>
<ul>
<li>发射队列中每条指令的目的寄存器对应一个 DELAY 值<ul>
<li>DELAY 值位宽由 FU 中最多需要周期数决定：8 位 4 周期编码 11111000</li>
<li>DELAY 值同分配电路一同写入发射队列</li>
<li>指令被仲裁电路选中后广播时，同时将 DELAY 值广播到总线 DELAY bus</li>
</ul>
</li>
<li>发射队列的每条指令的源寄存器添加一个移位寄存器和移位使能位<ul>
<li>广播匹配后，使能位拉高，移位寄存器初始值置为DELAY bus上的值</li>
<li>使能位拉高后，移位寄存器每周期算术右移1位，其最后一位表示进入ready状态</li>
<li>当指令被仲裁电路选中并收到响应信号后将使能位和移位寄存器清零</li>
</ul>
</li>
</ul>
<blockquote>
<p>可以使用功能单元完成计算的 valid 信号作为指令 ready 唤醒的条件吗？  </p>
<p>使用指定周期延迟的目的是为了实现背靠背执行，tomusolu 算法本身就是以指令执行完作为置位 ready 的条件，但这样对于 RAW 相关的指令不能实现背靠背执行</p>
</blockquote>
<p>如果有多条使用相同功能单元的指令均延迟唤醒，第一条收到响应后后续其他几条不能置位 ready ，所以可以在功能单元中维护一个 valid 表（移位寄存器 or FIFO），每开始执行一条指令就移位一次（移位值 0 ），同时有一个指针指向第一个 0 项，执行结束前一个周期就将指针处置 1 并下移到下一条 0 项</p>
<p>同时，发射队列中延迟唤醒的指令可以记录功能单元中 valid 表的地址，来匹配指定的 valid 信号</p>
<h2 id="推测唤醒-speculative-wake-up"><a href="#推测唤醒-speculative-wake-up" class="headerlink" title="推测唤醒 (speculative wake-up)"></a>推测唤醒 (speculative wake-up)</h2><p>针对执行周期数不确定的指令，如 load 指令、除法指令等</p>
<ul>
<li>最简单的处理方法是：等指令执行完再进行唤醒<ul>
<li>tomasulo算法</li>
<li>问题: <strong>RAW 相关的指令不能背靠背执行</strong></li>
</ul>
</li>
<li>对于 load 指令，其延迟取决于 DCache 和 TLB 的命中情况<ul>
<li>hit 则周期数确定</li>
</ul>
</li>
</ul>
<h3 id="Load指令的推测唤醒"><a href="#Load指令的推测唤醒" class="headerlink" title="Load指令的推测唤醒"></a>Load指令的推测唤醒</h3><ul>
<li>总是预测 hit ，因为 DCache 的命中率很高</li>
<li>按照 DCache hit 的周期数进行延迟唤醒</li>
<li>预测错误的处理<ul>
<li>状态恢复<ul>
<li>发射队列中被Load指令唤醒的所有寄存器置为 not ready 状态</li>
<li>被 Load 唤醒并且离开发射队列的指令需要从流水线中清除，重新放回发射队列</li>
</ul>
</li>
<li>之后 Load 指令可以继续按照 L2Cache hit 继续进行预测，一直到 DRAM</li>
</ul>
</li>
<li>对于支持虚拟存储的 DCache , TLB miss也需要按照预测错误进行处理<ul>
<li>对于软件处理TLB miss ，按照异常的方式处理</li>
</ul>
</li>
<li>对于不同结构的 DCache, 预测执行的方式不同:<br><strong>to be continued …</strong></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://xixi-shredp.github.io">xixi</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://xixi-shredp.github.io/2025/10/29/Arch/ooo/issue/wake_up/">https://xixi-shredp.github.io/2025/10/29/Arch/ooo/issue/wake_up/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/10/29/Arch/ooo/issue/issue_queue/" title="OOO CPU Issue Stage: Issue Queue"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">OOO CPU Issue Stage: Issue Queue</div></div><div class="info-2"><div class="info-item-1">发射队列 (Issue Queue) &#x2F; 保留站 (Reservation Station)  J. Abella, R. Canal, and A. González. Power- and Complexity-Aware Issue Queue Designs. IEEE Micro, 23(5):50–58, September–October 2003. doi:10.1109&#x2F;MM.2003.1240212  任务：保存已被重命名但未被送到功能单元执行的指令 集中式 (Centralized) or 分布式 (Distributed)实例：  reservation stations IBM Power6H.Q. Le, W.J. Starke, J.S. Fields, F.P. O’Connell, D.Q. Nguyen, B.J. Ronchetti, W.M. Sauer, E.M. Schwarz, and M.T. Vaden. IBM POWER6 Microarchitecture. IBM Journal of Research...</div></div></div></a><a class="pagination-related" href="/2025/10/29/Arch/ooo/issue/arbiter/" title="OOO CPU Issue Stage: Select/Arbiter"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">OOO CPU Issue Stage: Select/Arbiter</div></div><div class="info-2"><div class="info-item-1">任务：从发射队列中选择出 n 个 ready 的指令送到功能单元中 最优目标： oldest-first 对于压缩式发射队列：仲裁电路实现简单，只需选择发射队列最下面的 n 个 entry 对于非压缩式发射队列：对于分布式发射队列：采用 1-of-M 仲裁每周期从发射队列的 M 个 entry 中选出 1 条指令送到功能单元  识别出发射队列中的哪些指令是 oldest 的？ 需要指令的年龄信息：可以利用 ROB 的地址 ROB 本质是 FIFO ，存在读写指针翻转的问题 给 ROB 的每个 entry 增加一位位置位表明是否翻转 当位置位相同时， ROB 的地址值越小，对应的指令越旧 当位置位不同时， ROB 的地址值越大，对应的指令越旧   指令的年龄信息需要写入发射队列（即发射队列每个 entry 需要 Age field ）   屏蔽掉未 ready 的指令？ 发射队列中每个 entry 增加一位 ready 位 仲裁电路根据 ready 位和年龄信息进行比较   如何比较年龄信息选出最 oldest 的指令？ 多级比较电路：对于容量为 N 的发射队列，需要的比较电路级数...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">xixi</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">47</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">29</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xixi-shredp"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/xixi-shredp" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my blog, for learning and communication purposes only. If there is any copyright infringement, please leave a message via email on GitHub.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Tomasulo-%E7%AE%97%E6%B3%95%E5%94%A4%E9%86%92"><span class="toc-number">1.</span> <span class="toc-text">Tomasulo 算法唤醒</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#back-to-back-%E8%83%8C%E9%9D%A0%E8%83%8C%E6%89%A7%E8%A1%8C%E5%94%A4%E9%86%92"><span class="toc-number">2.</span> <span class="toc-text">back-to-back 背靠背执行唤醒</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E5%8D%95%E5%91%A8%E6%9C%9F%E6%8C%87%E4%BB%A4"><span class="toc-number">2.1.</span> <span class="toc-text">对于单周期指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E5%A4%9A%E5%91%A8%E6%9C%9F%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.</span> <span class="toc-text">对于多周期指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%B6%E8%BF%9F%E5%B9%BF%E6%92%AD-delayed-tag-broadcast"><span class="toc-number">2.2.1.</span> <span class="toc-text">延迟广播 (delayed tag broadcast)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%B6%E8%BF%9F%E5%94%A4%E9%86%92%EF%BC%88delayed-wake-up%EF%BC%89"><span class="toc-number">2.2.2.</span> <span class="toc-text">延迟唤醒（delayed wake-up）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A8%E6%B5%8B%E5%94%A4%E9%86%92-speculative-wake-up"><span class="toc-number">2.3.</span> <span class="toc-text">推测唤醒 (speculative wake-up)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Load%E6%8C%87%E4%BB%A4%E7%9A%84%E6%8E%A8%E6%B5%8B%E5%94%A4%E9%86%92"><span class="toc-number">2.3.1.</span> <span class="toc-text">Load指令的推测唤醒</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/06/os/generic/mm/" title="OS Virtual Memory Management">OS Virtual Memory Management</a><time datetime="2025-11-06T06:03:30.000Z" title="Created 2025-11-06 14:03:30">2025-11-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/06/os/linux/riscv/boot/" title="Linux RISC-V Boot 流程">Linux RISC-V Boot 流程</a><time datetime="2025-11-06T01:44:36.000Z" title="Created 2025-11-06 09:44:36">2025-11-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/04/os/linux/boot/" title="Linux Boot 过程">Linux Boot 过程</a><time datetime="2025-11-04T06:09:06.000Z" title="Created 2025-11-04 14:09:06">2025-11-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/04/os/generic/boot/init/" title="操作系统初始化">操作系统初始化</a><time datetime="2025-11-03T16:16:20.000Z" title="Created 2025-11-04 00:16:20">2025-11-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/03/os/generic/trap/" title="操作系统：Interupt, Exception, Syscall">操作系统：Interupt, Exception, Syscall</a><time datetime="2025-11-03T15:01:01.000Z" title="Created 2025-11-03 23:01:01">2025-11-03</time></div></div></div></div></div></div></main><footer id="footer" style="background: linear-gradient(160deg, #4D063C, #3E064D, #23064D, #08064D);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By xixi</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></span></div><div class="footer_custom_text">Life is so Beautify!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><div class="js-pjax"><script>(() => {
  const parseViewBox = viewBox => {
    if (!viewBox) return null
    const parts = viewBox.trim().split(/[\s,]+/).map(n => Number(n))
    if (parts.length !== 4 || parts.some(n => Number.isNaN(n))) return null
    return parts
  }

  const getSvgViewBox = svg => {
    const attr = parseViewBox(svg.getAttribute('viewBox'))
    if (attr) return attr

    // Fallback: use bbox to build a viewBox
    try {
      const bbox = svg.getBBox()
      if (bbox && bbox.width && bbox.height) return [bbox.x, bbox.y, bbox.width, bbox.height]
    } catch (e) {
      // getBBox may fail on some edge cases; ignore
    }

    const w = Number(svg.getAttribute('width')) || 0
    const h = Number(svg.getAttribute('height')) || 0
    if (w > 0 && h > 0) return [0, 0, w, h]
    return [0, 0, 100, 100]
  }

  const setSvgViewBox = (svg, vb) => {
    svg.setAttribute('viewBox', `${vb[0]} ${vb[1]} ${vb[2]} ${vb[3]}`)
  }

  const clamp = (v, min, max) => Math.max(min, Math.min(max, v))

  const openSvgInNewTab = ({ source, initViewBox }) => {
    const getClonedSvg = () => {
      if (typeof source === 'string') {
        const template = document.createElement('template')
        template.innerHTML = source.trim()
        const svg = template.content.querySelector('svg')
        return svg ? svg.cloneNode(true) : null
      }
      if (source && typeof source.cloneNode === 'function') {
        return source.cloneNode(true)
      }
      return null
    }

    const clone = getClonedSvg()
    if (!clone) return
    if (initViewBox && initViewBox.length === 4) {
      clone.setAttribute('viewBox', initViewBox.join(' '))
    }
    if (!clone.getAttribute('xmlns')) clone.setAttribute('xmlns', 'http://www.w3.org/2000/svg')
    if (!clone.getAttribute('xmlns:xlink') && clone.outerHTML.includes('xlink:')) {
      clone.setAttribute('xmlns:xlink', 'http://www.w3.org/1999/xlink')
    }
    // inject background to match current theme
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark'
    const bg = getComputedStyle(document.body).backgroundColor || (isDark ? '#1e1e1e' : '#ffffff')
    if (!clone.style.background) clone.style.background = bg

    const serializer = new XMLSerializer()
    const svgSource = serializer.serializeToString(clone)
    const htmlSource = `<!doctype html><html><head><meta charset="utf-8" />
      <style>
        html, body { width: 100%; height: 100%; margin: 0; display: flex; align-items: center; justify-content: center; background: ${bg}; }
        svg { max-width: 100%; max-height: 100%; height: auto; width: auto; }
      </style>
      </head><body>${svgSource}</body></html>`
    const blob = new Blob([htmlSource], { type: 'text/html;charset=utf-8' })
    const url = URL.createObjectURL(blob)
    window.open(url, '_blank', 'noopener')
    setTimeout(() => URL.revokeObjectURL(url), 30000)
  }

  const attachMermaidViewerButton = wrap => {
    let btn = wrap.querySelector('.mermaid-open-btn')
    if (!btn) {
      btn = document.createElement('button')
      btn.type = 'button'
      btn.className = 'mermaid-open-btn'
      wrap.appendChild(btn)
    }

    btn.innerHTML = '<i class="fa fa-search fa-fw" aria-hidden="true"></i>'

    if (!btn.__mermaidViewerBound) {
      btn.addEventListener('click', e => {
        e.preventDefault()
        e.stopPropagation()
        const svg = wrap.__mermaidOriginalSvg || wrap.querySelector('svg')
        if (!svg) return
        const initViewBox = wrap.__mermaidInitViewBox
        if (typeof svg === 'string') {
          openSvgInNewTab({ source: svg, initViewBox })
          return
        }
        openSvgInNewTab({ source: svg, initViewBox })
      })
      btn.__mermaidViewerBound = true
    }
  }

  // Zoom around a point (px, py) in the SVG viewport (in viewBox coordinates)
  const zoomAtPoint = (vb, factor, px, py) => {
    const w = vb[2] * factor
    const h = vb[3] * factor
    const nx = px - (px - vb[0]) * factor
    const ny = py - (py - vb[1]) * factor
    return [nx, ny, w, h]
  }

  const initMermaidGestures = wrap => {
    const svg = wrap.querySelector('svg')
    if (!svg) return

    // Ensure viewBox exists so gestures always work
    const initVb = getSvgViewBox(svg)
    wrap.__mermaidInitViewBox = initVb
    wrap.__mermaidCurViewBox = initVb.slice()
    setSvgViewBox(svg, initVb)

    // Avoid binding multiple times on themeChange/pjax
    if (wrap.__mermaidGestureBound) return
    wrap.__mermaidGestureBound = true

    // Helper: map client (viewport) coordinate -> viewBox coordinate
    const clientToViewBox = (clientX, clientY) => {
      const rect = svg.getBoundingClientRect()
      const vb = wrap.__mermaidCurViewBox || getSvgViewBox(svg)
      const x = vb[0] + (clientX - rect.left) * (vb[2] / rect.width)
      const y = vb[1] + (clientY - rect.top) * (vb[3] / rect.height)
      return { x, y, rect, vb }
    }

    const state = {
      pointers: new Map(),
      startVb: null,
      startDist: 0,
      startCenter: null
    }

    const clampVb = vb => {
      const init = wrap.__mermaidInitViewBox || vb
      const minW = init[2] * 0.1
      const maxW = init[2] * 10
      const minH = init[3] * 0.1
      const maxH = init[3] * 10
      vb[2] = clamp(vb[2], minW, maxW)
      vb[3] = clamp(vb[3], minH, maxH)
      return vb
    }

    const setCurVb = vb => {
      vb = clampVb(vb)
      wrap.__mermaidCurViewBox = vb
      setSvgViewBox(svg, vb)
    }

    const onPointerDown = e => {
      // Allow only primary button for mouse
      if (e.pointerType === 'mouse' && e.button !== 0) return
      svg.setPointerCapture(e.pointerId)
      state.pointers.set(e.pointerId, { x: e.clientX, y: e.clientY })

      if (state.pointers.size === 1) {
        state.startVb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
      } else if (state.pointers.size === 2) {
        const pts = [...state.pointers.values()]
        const dx = pts[0].x - pts[1].x
        const dy = pts[0].y - pts[1].y
        state.startDist = Math.hypot(dx, dy)
        state.startVb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
        state.startCenter = { x: (pts[0].x + pts[1].x) / 2, y: (pts[0].y + pts[1].y) / 2 }
      }
    }

    const onPointerMove = e => {
      if (!state.pointers.has(e.pointerId)) return
      state.pointers.set(e.pointerId, { x: e.clientX, y: e.clientY })

      // Pan with 1 pointer
      if (state.pointers.size === 1 && state.startVb) {
        const p = [...state.pointers.values()][0]
        const prev = { x: e.clientX - e.movementX, y: e.clientY - e.movementY }
        // movementX/Y unreliable on touch, compute from stored last position
        const last = wrap.__mermaidLastSinglePointer || p
        const dxClient = p.x - last.x
        const dyClient = p.y - last.y
        wrap.__mermaidLastSinglePointer = p

        const { rect } = clientToViewBox(p.x, p.y)
        const vb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
        const dx = dxClient * (vb[2] / rect.width)
        const dy = dyClient * (vb[3] / rect.height)
        setCurVb([vb[0] - dx, vb[1] - dy, vb[2], vb[3]])
        return
      }

      // Pinch zoom with 2 pointers
      if (state.pointers.size === 2 && state.startVb && state.startDist > 0) {
        const pts = [...state.pointers.values()]
        const dx = pts[0].x - pts[1].x
        const dy = pts[0].y - pts[1].y
        const dist = Math.hypot(dx, dy)
        if (!dist) return
        const factor = state.startDist / dist // dist bigger => zoom in (viewBox smaller)

        const cx = (pts[0].x + pts[1].x) / 2
        const cy = (pts[0].y + pts[1].y) / 2
        const centerClient = { x: cx, y: cy }

        const pxy = clientToViewBox(centerClient.x, centerClient.y)
        const cpx = pxy.x
        const cpy = pxy.y

        const vb = zoomAtPoint(state.startVb, factor, cpx, cpy)
        setCurVb(vb)
      }
    }

    const onPointerUpOrCancel = e => {
      state.pointers.delete(e.pointerId)
      if (state.pointers.size === 0) {
        state.startVb = null
        state.startDist = 0
        state.startCenter = null
        wrap.__mermaidLastSinglePointer = null
      } else if (state.pointers.size === 1) {
        // reset single pointer baseline to avoid jump
        wrap.__mermaidLastSinglePointer = [...state.pointers.values()][0]
      }
    }

    // Wheel zoom (mouse/trackpad)
    const onWheel = e => {
      // ctrlKey on mac trackpad pinch; we treat both as zoom
      e.preventDefault()
      const delta = e.deltaY
      const zoomFactor = delta > 0 ? 1.1 : 0.9
      const { x, y } = clientToViewBox(e.clientX, e.clientY)
      const vb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
      setCurVb(zoomAtPoint(vb, zoomFactor, x, y))
    }

    const onDblClick = () => {
      const init = wrap.__mermaidInitViewBox
      if (!init) return
      wrap.__mermaidCurViewBox = init.slice()
      setSvgViewBox(svg, init)
    }

    svg.addEventListener('pointerdown', onPointerDown)
    svg.addEventListener('pointermove', onPointerMove)
    svg.addEventListener('pointerup', onPointerUpOrCancel)
    svg.addEventListener('pointercancel', onPointerUpOrCancel)
    svg.addEventListener('wheel', onWheel, { passive: false })
    svg.addEventListener('dblclick', onDblClick)
  }

  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild

      // Clear old render (themeChange/pjax will rerun)
      const oldSvg = item.querySelector('svg')
      if (oldSvg) oldSvg.remove()
      item.__mermaidGestureBound = false

      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
        if (true) initMermaidGestures(item)
        item.__mermaidOriginalSvg = svg
        if (true) attachMermaidViewerButton(item)
      }


      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>